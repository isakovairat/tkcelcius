"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8588,6320],{6320:function(e,t,a){a.d(t,{Eo:function(){return drawGif},loadGifImage:function(){return loadGifImage}});let i=[0,4,2,1],o=[8,8,4,2];let ByteStream=class ByteStream{constructor(e){this.pos=0,this.data=new Uint8ClampedArray(e)}getString(e){let t=this.data.slice(this.pos,this.pos+e);return this.pos+=t.length,t.reduce((e,t)=>e+String.fromCharCode(t),"")}nextByte(){return this.data[this.pos++]}nextTwoBytes(){return this.pos+=2,this.data[this.pos-2]+(this.data[this.pos-1]<<8)}readSubBlocks(){let e="",t=0;do{t=this.data[this.pos++];for(let a=t;--a>=0;e+=String.fromCharCode(this.data[this.pos++]));}while(0!==t);return e}readSubBlocksBin(){let e=this.data[this.pos],t=0;for(let a=0;0!==e;a+=e+1,e=this.data[this.pos+a])t+=e;let a=new Uint8Array(t);e=this.data[this.pos++];for(let t=0;0!==e;e=this.data[this.pos++])for(let i=e;--i>=0;a[t++]=this.data[this.pos++]);return a}skipSubBlocks(){for(;0!==this.data[this.pos];this.pos+=this.data[this.pos]+1);this.pos++}};let r={x:0,y:0};function parseColorTable(e,t){let a=[];for(let i=0;i<t;i++)a.push({r:e.data[e.pos],g:e.data[e.pos+1],b:e.data[e.pos+2]}),e.pos+=3;return a}async function parseImageBlock(e,t,a,r,l,s){let n=t.frames[r(!0)];n.left=e.nextTwoBytes(),n.top=e.nextTwoBytes(),n.width=e.nextTwoBytes(),n.height=e.nextTwoBytes();let g=e.nextByte(),h=(128&g)==128;n.sortFlag=(32&g)==32,n.reserved=(24&g)>>>3,h&&(n.localColorTable=parseColorTable(e,1<<(7&g)+1));let getColor=e=>{let{r:i,g:o,b:r}=(h?n.localColorTable:t.globalColorTable)[e];return e!==l(null)?{r:i,g:o,b:r,a:255}:{r:i,g:o,b:r,a:a?~~((i+o+r)/3):0}},f=(()=>{try{return new ImageData(n.width,n.height,{colorSpace:"srgb"})}catch(e){if(e instanceof DOMException&&"IndexSizeError"===e.name)return null;throw e}})();if(null==f)throw EvalError("GIF frame size is to large");let c=e.nextByte(),d=e.readSubBlocksBin(),p=1<<c,readBits=(e,t)=>{let a=e>>>3,i=7&e;return(d[a]+(d[a+1]<<8)+(d[a+2]<<16)&(1<<t)-1<<i)>>>i};if((64&g)==64){for(let a=0,l=c+1,g=0,h=[[0]],d=0;d<4;d++){if(i[d]<n.height){let e=0,t=0,r=!1;for(;!r;){let s=a;if(a=readBits(g,l),g+=l+1,a===p){l=c+1,h.length=p+2;for(let e=0;e<h.length;e++)h[e]=e<p?[e]:[]}else{for(let r of(a>=h.length?h.push(h[s].concat(h[s][0])):s!==p&&h.push(h[s].concat(h[a][0])),h[a])){let{r:a,g:l,b:s,a:g}=getColor(r);f.data.set([a,l,s,g],i[d]*n.width+o[d]*t+e%(4*n.width)),e+=4}h.length===1<<l&&l<12&&l++}e===4*n.width*(t+1)&&(t++,i[d]+o[d]*t>=n.height&&(r=!0))}}s?.(e.pos/(e.data.length-1),r(!1)+1,f,{x:n.left,y:n.top},{width:t.width,height:t.height})}n.image=f,n.bitmap=await createImageBitmap(f)}else{let a=0,i=c+1,o=0,l=-4,g=!1,h=[[0]];for(;!g;){let e=a;if(a=readBits(o,i),o+=i,a===p){i=c+1,h.length=p+2;for(let e=0;e<h.length;e++)h[e]=e<p?[e]:[]}else{if(a===p+1){g=!0;break}for(let t of(a>=h.length?h.push(h[e].concat(h[e][0])):e!==p&&h.push(h[e].concat(h[a][0])),h[a])){let{r:e,g:a,b:i,a:o}=getColor(t);f.data.set([e,a,i,o],l+=4)}h.length>=1<<i&&i<12&&i++}}n.image=f,n.bitmap=await createImageBitmap(f),s?.((e.pos+1)/e.data.length,r(!1)+1,n.image,{x:n.left,y:n.top},{width:t.width,height:t.height})}}async function parseBlock(e,t,a,i,o,r){switch(e.nextByte()){case 59:return!0;case 44:await parseImageBlock(e,t,a,i,o,r);break;case 33:!function(e,t,a,i){switch(e.nextByte()){case 249:{let o=t.frames[a(!1)];e.pos++;let r=e.nextByte();o.GCreserved=(224&r)>>>5,o.disposalMethod=(28&r)>>>2,o.userInputDelayFlag=(2&r)==2,o.delayTime=10*e.nextTwoBytes();let l=e.nextByte();(1&r)==1&&i(l),e.pos++;break}case 255:{e.pos++;let a={identifier:e.getString(8),authenticationCode:e.getString(3),data:e.readSubBlocksBin()};t.applicationExtensions.push(a);break}case 254:t.comments.push([a(!1),e.readSubBlocks()]);break;case 1:if(0===t.globalColorTable.length)throw EvalError("plain text extension without global color table");e.pos++,t.frames[a(!1)].plainTextData={left:e.nextTwoBytes(),top:e.nextTwoBytes(),width:e.nextTwoBytes(),height:e.nextTwoBytes(),charSize:{width:e.nextTwoBytes(),height:e.nextTwoBytes()},foregroundColor:e.nextByte(),backgroundColor:e.nextByte(),text:e.readSubBlocks()};break;default:e.skipSubBlocks()}}(e,t,i,o);break;default:throw EvalError("undefined block found")}return!1}async function decodeGIF(e,t,a){a||(a=!1);let i=await fetch(e);if(!i.ok&&404===i.status)throw EvalError("file not found");let o=await i.arrayBuffer(),r={width:0,height:0,totalTime:0,colorRes:0,pixelAspectRatio:0,frames:[],sortFlag:!1,globalColorTable:[],backgroundImage:new ImageData(1,1,{colorSpace:"srgb"}),comments:[],applicationExtensions:[]},l=new ByteStream(new Uint8ClampedArray(o));if("GIF89a"!==l.getString(6))throw Error("not a supported GIF file");r.width=l.nextTwoBytes(),r.height=l.nextTwoBytes();let s=l.nextByte(),n=(128&s)==128;r.colorRes=(112&s)>>>4,r.sortFlag=(8&s)==8;let g=l.nextByte();r.pixelAspectRatio=l.nextByte(),0!==r.pixelAspectRatio&&(r.pixelAspectRatio=(r.pixelAspectRatio+15)/64),n&&(r.globalColorTable=parseColorTable(l,1<<(7&s)+1));let h=(()=>{try{return new ImageData(r.width,r.height,{colorSpace:"srgb"})}catch(e){if(e instanceof DOMException&&"IndexSizeError"===e.name)return null;throw e}})();if(null==h)throw Error("GIF frame size is to large");let{r:f,g:c,b:d}=r.globalColorTable[g];h.data.set(n?[f,c,d,255]:[0,0,0,0]);for(let e=4;e<h.data.length;e*=2)h.data.copyWithin(e,0,e);r.backgroundImage=h;let p=-1,m=!0,u=-1,getframeIndex=e=>(e&&(m=!0),p),getTransparencyIndex=e=>(null!=e&&(u=e),u);try{do m&&(r.frames.push({left:0,top:0,width:0,height:0,disposalMethod:0,image:new ImageData(1,1,{colorSpace:"srgb"}),plainTextData:null,userInputDelayFlag:!1,delayTime:0,sortFlag:!1,localColorTable:[],reserved:0,GCreserved:0}),p++,u=-1,m=!1);while(!await parseBlock(l,r,a,getframeIndex,getTransparencyIndex,t));for(let e of(r.frames.length--,r.frames)){if(e.userInputDelayFlag&&0===e.delayTime){r.totalTime=1/0;break}r.totalTime+=e.delayTime}return r}catch(e){if(e instanceof EvalError)throw Error(`error while parsing frame ${p} "${e.message}"`);throw e}}function drawGif(e){let{context:t,radius:a,particle:i,delta:o}=e,l=i.image;if(!l?.gifData||!l.gif)return;let s=new OffscreenCanvas(l.gifData.width,l.gifData.height),n=s.getContext("2d");if(!n)throw Error("could not create offscreen canvas context");n.imageSmoothingQuality="low",n.imageSmoothingEnabled=!1,n.clearRect(r.x,r.y,s.width,s.height),void 0===i.gifLoopCount&&(i.gifLoopCount=l.gifLoopCount??0);let g=i.gifFrame??0,h={x:-(.5*l.gifData.width),y:-(.5*l.gifData.height)},f=l.gifData.frames[g];if(void 0===i.gifTime&&(i.gifTime=0),f.bitmap){switch(t.scale(a/l.gifData.width,a/l.gifData.height),f.disposalMethod){case 4:case 5:case 6:case 7:case 0:n.drawImage(f.bitmap,f.left,f.top),t.drawImage(s,h.x,h.y),n.clearRect(r.x,r.y,s.width,s.height);break;case 1:n.drawImage(f.bitmap,f.left,f.top),t.drawImage(s,h.x,h.y);break;case 2:n.drawImage(f.bitmap,f.left,f.top),t.drawImage(s,h.x,h.y),n.clearRect(r.x,r.y,s.width,s.height),l.gifData.globalColorTable.length?n.putImageData(l.gifData.backgroundImage,h.x,h.y):n.putImageData(l.gifData.frames[0].image,h.x+f.left,h.y+f.top);break;case 3:{let e=n.getImageData(r.x,r.y,s.width,s.height);n.drawImage(f.bitmap,f.left,f.top),t.drawImage(s,h.x,h.y),n.clearRect(r.x,r.y,s.width,s.height),n.putImageData(e,r.x,r.y)}}if(i.gifTime+=o.value,i.gifTime>f.delayTime){if(i.gifTime-=f.delayTime,++g>=l.gifData.frames.length){if(--i.gifLoopCount<=0)return;g=0,n.clearRect(r.x,r.y,s.width,s.height)}i.gifFrame=g}t.scale(l.gifData.width/a,l.gifData.height/a)}}async function loadGifImage(e){if("gif"!==e.type){let{loadImage:t}=await Promise.resolve().then(a.bind(a,4632));await t(e);return}e.loading=!0;try{e.gifData=await decodeGIF(e.source),e.gifLoopCount=function(e){for(let t of e.applicationExtensions)if(t.identifier+t.authenticationCode==="NETSCAPE2.0")return t.data[1]+(t.data[2]<<8);return NaN}(e.gifData)??0,e.gifLoopCount||(e.gifLoopCount=1/0)}catch{e.error=!0}e.loading=!1}},8588:function(e,t,a){a.d(t,{ImageDrawer:function(){return ImageDrawer}});var i=a(1457),o=a(4632),r=a(6320);let ImageDrawer=class ImageDrawer{constructor(e){this.loadImageShape=async e=>{if(!this._engine.loadImage)throw Error(`${i.gK} image shape not initialized`);await this._engine.loadImage({gif:e.gif,name:e.name,replaceColor:e.replaceColor??!1,src:e.src})},this._engine=e}addImage(e){this._engine.images||(this._engine.images=[]),this._engine.images.push(e)}draw(e){let{context:t,radius:a,particle:i,opacity:o}=e,l=i.image,s=l?.element;if(l){if(t.globalAlpha=o,l.gif&&l.gifData)(0,r.Eo)(e);else if(s){let e=l.ratio,i={x:-a,y:-a},o=2*a;t.drawImage(s,i.x,i.y,o,o/e)}t.globalAlpha=1}}getSidesCount(){return 12}async init(e){let t=e.actualOptions;if(t.preload&&this._engine.loadImage)for(let e of t.preload)await this._engine.loadImage(e)}loadShape(e){if("image"!==e.shape&&"images"!==e.shape)return;this._engine.images||(this._engine.images=[]);let t=e.shapeData;if(!t)return;let a=this._engine.images.find(e=>e.name===t.name||e.source===t.src);a||this.loadImageShape(t).then(()=>{this.loadShape(e)})}particleInit(e,t){if("image"!==t.shape&&"images"!==t.shape)return;this._engine.images||(this._engine.images=[]);let a=this._engine.images,i=t.shapeData;if(!i)return;let r=t.getFillColor(),l=a.find(e=>e.name===i.name||e.source===i.src);if(!l)return;let s=i.replaceColor??l.replaceColor;if(l.loading){setTimeout(()=>{this.particleInit(e,t)});return}(async()=>{let e;(e=l.svgData&&r?await (0,o.e)(l,i,r,t):{color:r,data:l,element:l.element,gif:l.gif,gifData:l.gifData,gifLoopCount:l.gifLoopCount,loaded:!0,ratio:i.width&&i.height?i.width/i.height:l.ratio??1,replaceColor:s,source:i.src}).ratio||(e.ratio=1);let a=i.fill??t.shapeFill,n=i.close??t.shapeClose,g={image:e,fill:a,close:n};t.image=g.image,t.shapeFill=g.fill,t.shapeClose=g.close})()}}}}]);